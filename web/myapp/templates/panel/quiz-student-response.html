<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <title>Student Quiz Response</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap">
  <link rel="stylesheet" href="{% static 'css/quiz-student-responses-admin.css' %}">
</head>
<body>
  <div class="exam-responses-admin-container">
    <!-- Navigation Sidebar -->
    <div class="exam-admin-navigation">
      <div class="logo-container"></div>
      <div class="nav-buttons-container">
        <a href="{% url 'admin_dashboard' %}" style="text-decoration: none;"><div class="nav-button" style="border:  #854BAB 1px solid;">
          <img src="{% static 'public3/external/dashboardlayout2136-pwh-200w.png' %}" alt="Dashboard" class="nav-icon">
          <span>Dashboard</span>
        </div></a>
        <a href="{% url 'admin_students' %}" style="text-decoration: none;"><div class="nav-button" style="border:  #854BAB 1px solid;">
          <img src="{% static 'public3/external/studentmale2134-uejm-200h.png' %}" alt="Students" class="nav-icon">
          <span>Students</span>
        </div></a>
        <a href="{% url 'admin_attendance' %}" style="text-decoration: none;"><div class="nav-button" style="border:  #854BAB 1px solid;">
          <img src="{% static 'public3/external/attendance7018-1v4-200h.png' %}" alt="Attendance" class="nav-icon">
          <span>Attendance</span>
        </div></a>
        <a href="{% url 'admin_quiz' %}" style="text-decoration: none;"><div class="nav-button active">
          <img src="{% static 'public3/external/quiz2137-2g3-200h.png' %}" alt="Quiz" class="nav-icon">
          <span>Quiz</span>
        </div></a>
        <a href="{% url 'admin_exam' %}" style="text-decoration: none;"><div class="nav-button" style="border:  #854BAB 1px solid;">
          <img src="{% static 'public3/external/exam2137-tdwn-200w.png' %}" alt="Exam" class="nav-icon">
          <span>Exam</span>
        </div></a>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="page-header">
        <img src="{% static 'public3/external/quiz2137-3uc7-200h.png' %}" alt="Quiz" class="header-icon">
        <h1>Student Quiz Response</h1>
        <div class="student-info">
          <span class="student-name">{{ quiz_result.student.user.get_full_name }}</span>
          <span class="student-score">Score: {{ quiz_result.score }}/{{ quiz_result.total_points }}</span>
        </div>
      </div>
      
      <div class="divider"></div>
      
      <!-- Quiz Info -->
      <div class="exam-info-card">
        <h2>{{ quiz_result.quiz.title }}</h2>
        <div class="exam-meta">
          <span>Total Questions: {{ quiz_result.quiz.total_questions }}</span>
          <span>Time Limit: {{ quiz_result.quiz.time_limit }} minutes</span>
          <span>Due Date: {{ quiz_result.quiz.due_date|date:"F j, Y" }}</span>
        </div>
      </div>
      
      <!-- Question Container -->
      <form method="POST" action="{% url 'grade_quiz' quiz_id=quiz_result.quiz.id result_id=quiz_result.id %}">
        {% csrf_token %}
        <div class="question-container" id="questionContainer">
          {% for answer in answers %}
          <div class="question-card">
            <h3>Question {{ forloop.counter }}</h3>
            <p class="question-text">{{ answer.question.content }}</p>
            
            {% if answer.question.question_type == 'multiple_choice' %}
              <div class="options-container">
                {% for choice in answer.question.choices.all %}
                  <div class="option {% if choice == answer.selected_choice %}selected{% endif %} {% if choice.is_correct %}correct{% endif %}">
                    <div class="option-indicator"></div>
                    <span>{{ choice.text }}</span>
                    {% if choice == answer.selected_choice %}
                      {% if choice.is_correct %}
                        <span class="correct-label">Correct</span>
                      {% else %}
                        <span class="incorrect-label">Incorrect</span>
                      {% endif %}
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="answer-container">
                <div class="student-answer">
                  <h4>Student's Answer:</h4>
                  <p>{{ answer.answer_text }}</p>
                </div>
                <div class="grading-section">
                  <h4>Grade this answer:</h4>
                  <div class="grading-buttons">
                    <button type="button" class="btn-correct" onclick="markAnswer({{ answer.id }}, true)">Correct</button>
                    <button type="button" class="btn-incorrect" onclick="markAnswer({{ answer.id }}, false)">Incorrect</button>
                  </div>
                  <input type="hidden" name="correct_{{ answer.id }}" id="correct_{{ answer.id }}" value="{{ answer.is_correct|lower }}">
                  <div class="feedback-section">
                    <label for="feedback_{{ answer.id }}">Feedback:</label>
                    <textarea name="feedback_{{ answer.id }}" id="feedback_{{ answer.id }}" class="feedback-input">{{ answer.feedback }}</textarea>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        
        <div class="grading-actions">
          <button type="submit" class="btn-submit">Submit Grading</button>
          <a href="{% url 'quiz_responses' quiz_id=quiz_result.quiz.id %}" class="btn-cancel">Back to Responses</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    function markAnswer(answerId, isCorrect) {
      const correctInput = document.getElementById(`correct_${answerId}`);
      const correctBtn = document.querySelector(`button[onclick="markAnswer(${answerId}, true)"]`);
      const incorrectBtn = document.querySelector(`button[onclick="markAnswer(${answerId}, false)"]`);
      
      correctInput.value = isCorrect;
      
      if (isCorrect) {
        correctBtn.classList.add('active');
        incorrectBtn.classList.remove('active');
      } else {
        correctBtn.classList.remove('active');
        incorrectBtn.classList.add('active');
      }
    }

    // Initialize the grading buttons based on existing values
    document.addEventListener('DOMContentLoaded', function() {
      {% for answer in answers %}
        {% if answer.question.question_type == 'short_answer' %}
          const correct_{{ answer.id }} = document.getElementById('correct_{{ answer.id }}').value;
          if (correct_{{ answer.id }} === 'true') {
            markAnswer({{ answer.id }}, true);
          } else if (correct_{{ answer.id }} === 'false') {
            markAnswer({{ answer.id }}, false);
          }
        {% endif %}
      {% endfor %}
    });

    // Toggle account menu
    function toggleAccountMenu() {
      const menu = document.getElementById('accountMenu');
      menu.classList.toggle('active');
    }
    
    // Close account menu when clicking outside
    document.addEventListener('click', function(event) {
      const accountMenu = document.getElementById('accountMenu');
      const accountButton = document.querySelector('.account-button');
      
      if (!accountButton.contains(event.target) && !accountMenu.contains(event.target)) {
        accountMenu.classList.remove('active');
      }
    });
  </script>
</body>
</html>